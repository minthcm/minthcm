import{l as R,Z as N,bd as F,z as c,e as H,n as o,w as r,C as d,j as i,A as U,k as $,be as j,x as I,bf as G,bg as f,K as z,y as g,t as K,s as b,q as x,F as Z,v as J,r as Q,bh as W,P as X,ab as Y,bi as q,bj as ee,bk as h,_ as ae}from"./index.10d9344d.js";const ne={key:2},te=["innerHTML"],le=500,se=R({__name:"relate.edit",props:{defs:{},label:{},modelValue:{},data:{}},emits:["update:modelValue"],setup(B,{emit:M}){const e=B,A=M;let v=null;const _=N(),D=F(),p=c(!1),u=c(e.data.bean[e.defs.id_name]?[{id:e.data.bean[e.defs.id_name],name:e.modelValue}]:[]),V=c({id:e.data.bean[e.defs.id_name],name:e.data.bean[e.defs.name]}),m=c(!1),s=H({get(){return V.value},set(a){e.data.bean[e.defs.id_name]=a.id,V.value=a,A("update:modelValue",[e.defs.id_name])}});async function C(a){var n,t,l;if(s.value.name.length>=3){u.value=[],m.value=!0,p.value=!0;const k=(l=(t=(n=a==null?void 0:a.target)==null?void 0:n.value)!=null?t:e.data.bean[e.defs.name])!=null?l:"";v&&clearTimeout(v),v=window.setTimeout(async()=>{var L,T;const y=await q.getListData(e.defs.module,"",{must:[{wildcard:{name:k+"*"}}]});(T=(L=y.data)==null?void 0:L.results)!=null&&T.length&&(u.value=y.data.results.sort((O,S)=>O.name.localeCompare(S.name,"pl"))),m.value=!1},le)}else u.value=[]}function E(){D.showPopup({component:ee,title:N().translateListValue(e.defs.module,"moduleList"),icon:"mdi-view-list",data:{moduleName:e.defs.module,popupMode:"single",fieldToNameArray:{id:e.defs.id_name,name:e.defs.name},onConfirm:a=>{s.value={id:a.nameToValueArray[e.defs.id_name],name:a.nameToValueArray[e.defs.name]}},onClose:()=>{}}})}function P(a){s.value={id:a.id,name:a.name}}function w(a,n){if(n=h.encode(n),a=h.encode(a),!n)return a;try{const t=new RegExp(`\\b(${n.split(" ").filter(l=>!["AND","OR"].includes(l)&&l.length>2).join("|")})`,"gi");return a=a.replace(t,'<span class="highlighted">$&</span>'),a}catch{return a}}return(a,n)=>(o(),r(Y,{modelValue:p.value,"onUpdate:modelValue":n[5]||(n[5]=t=>p.value=t),location:"bottom"},{activator:d(t=>[i(U,$({label:e.label,variant:"outlined",density:"compact","hide-details":"",modelValue:s.value.name,"onUpdate:modelValue":n[1]||(n[1]=l=>s.value.name=l)},t.props,{onInput:n[2]||(n[2]=l=>C(l)),onClick:n[3]||(n[3]=l=>p.value=!1)}),{"append-inner":d(()=>[i(j,{class:"search-prepend-icon"},{default:d(()=>[s.value.name?(o(),r(I,{key:0,icon:"mdi-close",onClick:n[0]||(n[0]=l=>s.value={id:"",name:""})})):(o(),r(I,{key:1,icon:"mdi-magnify"}))]),_:1})]),_:2},1040,["label","modelValue"])]),default:d(()=>[i(G,null,{default:d(()=>[m.value?(o(),r(f,{key:0},{default:d(()=>[i(z,{color:"primary",indeterminate:""})]),_:1})):g("",!0),!m.value&&!u.value.length?(o(),r(f,{key:1,class:"text-caption",textContent:K(!u.value||s.value.name.length<3?b(_).label("LBL_MINT4_GS_HELP_TIP"):b(_).label("LBL_MINT4_GS_NO_RECORDS_FOUND")),onInput:n[4]||(n[4]=t=>C(t,a.index))},null,8,["textContent"])):g("",!0),m.value?g("",!0):(o(),x("div",ne,[(o(!0),x(Z,null,J(u.value,(t,l)=>(o(),r(f,{onClick:k=>P(t),key:l},{default:d(()=>[Q("span",{innerHTML:w(t.name,s.value.name)},null,8,te)]),_:2},1032,["onClick"]))),128))])),i(W),i(f,null,{default:d(()=>[i(X,{variant:"text",text:b(_).label("LBL_ADVANCED_SEARCH_BUTTON"),onClick:E,icon:"mdi-text-search",color:"primary"},null,8,["text"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const de=ae(se,[["__scopeId","data-v-77d604de"]]);export{de as default};
