import{l as G,Z as I,bk as K,z as f,e as M,n as u,q as g,j as i,s as p,bi as O,B as j,C as r,A as z,k as J,bl as Z,w as v,x as S,bm as Q,bn as b,J as W,y as V,t as X,F as Y,v as q,r as ee,bo as ae,P as te,aa as ne,a as le,bp as se,bq as D,_ as oe}from"./index.94e4d627.js";const ie={class:"parent-container"},de={key:2},ue=["innerHTML"],re=500,me=G({__name:"parent.edit",props:{defs:{},label:{},modelValue:{},data:{}},emits:["update:modelValue"],setup(A,{emit:R}){const a=A,L=R;let y=null;const d=I(),w=K(),_=f(!1),m=f(a.data.bean[a.defs.id_name]?[{id:a.data.bean[a.defs.id_name],name:a.modelValue}]:[]),C=f({id:a.data.bean[a.defs.id_name],name:a.data.bean[a.defs.name]}),s=M({get(){return C.value},set(t){a.data.bean[a.defs.id_name]=t.id,C.value=t,L("update:modelValue",[a.defs.id_name])}}),x=f(""),T=M({get(){var t,e,l,n;return d.translateListValue((l=(e=a.data.bean.parent_type)!=null?e:(t=a.defs)==null?void 0:t.default)!=null?l:"",(n=a.defs)==null?void 0:n.options)},set(t){var n;let e=d.languages.app_list_strings[(n=a.defs)==null?void 0:n.options],l=Object.keys(e).find(o=>e[o]===t);a.data.bean[a.defs.type_name]=l,x.value=l,s.value={id:"",name:""},L("update:modelValue",[a.defs.type_name])}}),c=f(!1);async function $(t){var e,l,n;if(s.value.name.length>=3){m.value=[],c.value=!0,_.value=!0;const k={field:"name",type:"wildcard",value:((n=(l=(e=t==null?void 0:t.target)==null?void 0:e.value)!=null?l:a.data.bean[a.defs.name])!=null?n:"").toLowerCase()+"*"};y&&clearTimeout(y),y=window.setTimeout(async()=>{var N,B;const E=await le.post(`api/${a.data.bean.parent_type}`,{offset:0,sortBy:"name",filters:[k]});(B=(N=E.data)==null?void 0:N.results)!=null&&B.length&&(m.value=E.data.results.sort((F,H)=>F.name.localeCompare(H.name,"pl"))),c.value=!1},re)}else m.value=[]}function P(){w.showPopup({component:se,title:I().translateListValue(a.data.bean.parent_type,"moduleList"),icon:"mdi-view-list",data:{moduleName:a.data.bean.parent_type,popupMode:"single",fieldToNameArray:{id:a.defs.id_name,name:a.defs.name},onConfirm:t=>{s.value={id:t.nameToValueArray[a.defs.id_name],name:t.nameToValueArray[a.defs.name]}},onClose:()=>{}}})}function h(t){s.value={id:t.id,name:t.name}}function U(t,e){if(e=D.encode(e),t=D.encode(t),!e)return t;try{const l=new RegExp(`\\b(${e.split(" ").filter(n=>!["AND","OR"].includes(n)&&n.length>2).join("|")})`,"gi");return t=t.replace(l,'<span class="highlighted">$&</span>'),t}catch{return t}}return(t,e)=>{var l;return u(),g("div",ie,[i(j,{items:p(d).getList((l=a.defs)==null?void 0:l.options),label:p(d).label("LBL_ASSIGNED_TO_MODULE"),variant:"outlined",density:"compact","hide-details":"",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=n=>T.value=n),"item-value":"value","item-title":"key",onKeyup:[e[1]||(e[1]=O(n=>t.$emit("inlineEditSave"),["enter"])),e[2]||(e[2]=O(n=>t.$emit("inlineEditCancel"),["esc"]))]},null,8,["items","label","modelValue"]),i(ne,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=n=>_.value=n),location:"bottom"},{activator:r(n=>[i(z,J({label:p(d).label("LBL_ASSIGNED_TO_RECORD"),variant:"outlined",density:"compact","hide-details":"",modelValue:s.value.name,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.name=o)},n.props,{onInput:e[5]||(e[5]=o=>$(o)),onClick:e[6]||(e[6]=o=>_.value=!1)}),{"append-inner":r(()=>[i(Z,{class:"search-prepend-icon"},{default:r(()=>[s.value.name?(u(),v(S,{key:0,icon:"mdi-close",onClick:e[3]||(e[3]=o=>s.value={id:"",name:""})})):(u(),v(S,{key:1,icon:"mdi-magnify"}))]),_:1})]),_:2},1040,["label","modelValue"])]),default:r(()=>[i(Q,null,{default:r(()=>[c.value?(u(),v(b,{key:0},{default:r(()=>[i(W,{color:"primary",indeterminate:""})]),_:1})):V("",!0),!c.value&&!m.value.length?(u(),v(b,{key:1,class:"text-caption",textContent:X(!m.value||s.value.name.length<3?p(d).label("LBL_MINT4_GS_HELP_TIP"):p(d).label("LBL_MINT4_GS_NO_RECORDS_FOUND"))},null,8,["textContent"])):V("",!0),c.value?V("",!0):(u(),g("div",de,[(u(!0),g(Y,null,q(m.value,(n,o)=>(u(),v(b,{onClick:k=>h(n),key:o},{default:r(()=>[ee("span",{innerHTML:U(n.name,s.value.name)},null,8,ue)]),_:2},1032,["onClick"]))),128))])),i(ae),i(b,null,{default:r(()=>[i(te,{variant:"text",text:p(d).label("LBL_ADVANCED_SEARCH_BUTTON"),onClick:P,icon:"mdi-text-search",color:"primary"},null,8,["text"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const ce=oe(me,[["__scopeId","data-v-d2d8e029"]]);export{ce as default};
