import{l as $,Z as T,bk as F,z as c,e as H,n as o,w as r,C as i,j as d,A as U,k as j,bl as G,x as N,bm as z,bn as f,J,y as g,t as Z,s as b,q as x,F as K,v as Q,r as W,bo as X,P as Y,aa as q,a as ee,bp as ae,bq as I,_ as ne}from"./index.94e4d627.js";const te={key:2},le=["innerHTML"],se=500,oe=$({__name:"relate.edit",props:{defs:{},label:{},modelValue:{},data:{}},emits:["update:modelValue"],setup(B,{emit:M}){const e=B,h=M;let v=null;const _=T(),w=F(),p=c(!1),u=c(e.data.bean[e.defs.id_name]?[{id:e.data.bean[e.defs.id_name],name:e.modelValue}]:[]),V=c({id:e.data.bean[e.defs.id_name],name:e.data.bean[e.defs.name]}),m=c(!1),s=H({get(){return V.value},set(a){e.data.bean[e.defs.id_name]=a.id,V.value=a,h("update:modelValue",[e.defs.id_name])}});async function C(a){var n,t,l;if(s.value.name.length>=3){u.value=[],m.value=!0,p.value=!0;const O={field:"name",type:"wildcard",value:((l=(t=(n=a==null?void 0:a.target)==null?void 0:n.value)!=null?t:e.data.bean[e.defs.name])!=null?l:"").toLowerCase()+"*"};v&&clearTimeout(v),v=window.setTimeout(async()=>{var k,L;const y=await ee.post(`api/${e.defs.module}`,{offset:0,sortBy:"name",filters:[O]});(L=(k=y.data)==null?void 0:k.results)!=null&&L.length&&(u.value=y.data.results.sort((S,R)=>S.name.localeCompare(R.name,"pl"))),m.value=!1},se)}else u.value=[]}function E(){w.showPopup({component:ae,title:T().translateListValue(e.defs.module,"moduleList"),icon:"mdi-view-list",data:{moduleName:e.defs.module,popupMode:"single",fieldToNameArray:{id:e.defs.id_name,name:e.defs.name},onConfirm:a=>{s.value={id:a.nameToValueArray[e.defs.id_name],name:a.nameToValueArray[e.defs.name]}},onClose:()=>{}}})}function P(a){s.value={id:a.id,name:a.name}}function A(a,n){if(n=I.encode(n),a=I.encode(a),!n)return a;try{const t=new RegExp(`\\b(${n.split(" ").filter(l=>!["AND","OR"].includes(l)&&l.length>2).join("|")})`,"gi");return a=a.replace(t,'<span class="highlighted">$&</span>'),a}catch{return a}}return(a,n)=>(o(),r(q,{modelValue:p.value,"onUpdate:modelValue":n[5]||(n[5]=t=>p.value=t),location:"bottom"},{activator:i(t=>[d(U,j({label:e.label,variant:"outlined",density:"compact","hide-details":"",modelValue:s.value.name,"onUpdate:modelValue":n[1]||(n[1]=l=>s.value.name=l)},t.props,{onInput:n[2]||(n[2]=l=>C(l)),onClick:n[3]||(n[3]=l=>p.value=!1)}),{"append-inner":i(()=>[d(G,{class:"search-prepend-icon"},{default:i(()=>[s.value.name?(o(),r(N,{key:0,icon:"mdi-close",onClick:n[0]||(n[0]=l=>s.value={id:"",name:""})})):(o(),r(N,{key:1,icon:"mdi-magnify"}))]),_:1})]),_:2},1040,["label","modelValue"])]),default:i(()=>[d(z,null,{default:i(()=>[m.value?(o(),r(f,{key:0},{default:i(()=>[d(J,{color:"primary",indeterminate:""})]),_:1})):g("",!0),!m.value&&!u.value.length?(o(),r(f,{key:1,class:"text-caption",textContent:Z(!u.value||s.value.name.length<3?b(_).label("LBL_MINT4_GS_HELP_TIP"):b(_).label("LBL_MINT4_GS_NO_RECORDS_FOUND")),onInput:n[4]||(n[4]=t=>C(t,a.index))},null,8,["textContent"])):g("",!0),m.value?g("",!0):(o(),x("div",te,[(o(!0),x(K,null,Q(u.value,(t,l)=>(o(),r(f,{onClick:D=>P(t),key:l},{default:i(()=>[W("span",{innerHTML:A(t.name,s.value.name)},null,8,le)]),_:2},1032,["onClick"]))),128))])),d(X),d(f,null,{default:i(()=>[d(Y,{variant:"text",text:b(_).label("LBL_ADVANCED_SEARCH_BUTTON"),onClick:E,icon:"mdi-text-search",color:"primary"},null,8,["text"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const de=ne(oe,[["__scopeId","data-v-784c710a"]]);export{de as default};
