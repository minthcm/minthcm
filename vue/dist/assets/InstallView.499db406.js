import{a as I,p as ce,m as me,o as pe,b as ve,g as fe,u as _e,c as be,d as ge,e as E,f as ye,h as he,V as ee,i as te,j as m,k as G,l as k,n as c,q as h,r as y,t as $,s as n,_ as S,F as P,v as K,w as C,x as M,y as D,z as g,A as V,B as we,C as N,D as Ve,E as ae,G as Ce,H as se,I as xe,J as ne,K as Ie,L as ke,M as Se,N as le,O as oe,P as J,Q as ie,R as re,S as Be,T as $e,U as Ee,W as Ue,X as Le,Y as Fe}from"./index.94e4d627.js";const{Axios:xt,AxiosError:Ae,CanceledError:It,isCancel:kt,CancelToken:St,VERSION:Bt,all:$t,Cancel:Et,isAxiosError:Ut,spread:Lt,toFormData:Ft,AxiosHeaders:At,HttpStatusCode:Dt,formToJSON:Nt,getAdapter:Pt,mergeConfig:Mt}=I;const De=ce({...me(),...pe(ve(),["inline"])},"VCheckbox"),Ne=fe()({name:"VCheckbox",inheritAttrs:!1,props:De(),emits:{"update:modelValue":d=>!0,"update:focused":d=>!0},setup(d,s){let{attrs:e,slots:l}=s;const i=_e(d,"modelValue"),{isFocused:t,focus:a,blur:r}=be(d),o=ge(),u=E(()=>d.id||`checkbox-${o}`);return ye(()=>{const[v,f]=he(e),_=ee.filterProps(d),x=te.filterProps(d);return m(ee,G({class:["v-checkbox",d.class]},v,_,{modelValue:i.value,"onUpdate:modelValue":L=>i.value=L,id:u.value,focused:t.value,style:d.style}),{...l,default:L=>{let{id:q,messagesId:z,isDisabled:O,isReadonly:j,isValid:R}=L;return m(te,G(x,{id:q.value,"aria-describedby":z.value,disabled:O.value,readonly:j.value},f,{error:R.value===!1,modelValue:i.value,"onUpdate:modelValue":H=>i.value=H,onFocus:a,onBlur:r}),l)}})}),{}}}),Pe={class:"install-view-license"},Me={class:"install-view-license-content"},Te=k({__name:"InstallViewLicense",setup(d,{expose:s}){const e=U();return s({nextBtn:{label:"Accept"}}),(l,i)=>(c(),h("div",Pe,[y("div",Me,$(n(e).license),1)]))}});const qe=S(Te,[["__scopeId","data-v-4019f6dd"]]),ze={class:"install-view-environment"},Oe={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},je={class:"install-view-environment-item-title"},Re={key:0,class:"install-view-environment-item-message"},He=k({__name:"InstallViewEnvironment",setup(d,{expose:s}){const e=U(),l=E(()=>e.environment&&Object.values(e.environment).every(t=>t.status===1)),i=E(()=>l.value?"Next":"Recheck");return s({nextBtn:{label:i,action:()=>{l.value?e.nextStep():e.recheckEnvironment()}}}),(t,a)=>(c(),h("div",ze,[(c(!0),h(P,null,K(n(e).environment,(r,o)=>(c(),h("div",{key:o,class:"install-view-environment-item"},[r.status===1?(c(),C(M,{key:0,icon:"mdi-check-circle",color:"#097c31",size:"20"})):(c(),C(M,{key:1,icon:"mdi-close-circle",color:"#ac0221",size:"20"})),y("div",Oe,[y("span",je,$(r.label),1),r.message?(c(),h("span",Re,$(r.message),1)):D("",!0)])]))),128))]))}});const Ge=S(He,[["__scopeId","data-v-ec046cca"]]),Je={class:"install-view-database-config"},Ke=k({__name:"InstallViewDatabaseConfig",setup(d,{expose:s}){const e=U(),l=g({dbname:"",host:"",port:"",username:""});return s({nextBtn:{action:async()=>{await e.validateDb()&&e.nextStep()}},validate:()=>{var t,a,r;l.value={dbname:"",host:"",port:"",username:""};let i=!0;return(t=e.databaseConfig.dbname)!=null&&t.trim()||(l.value.dbname="Field is required",i=!1),(a=e.databaseConfig.host)!=null&&a.trim()||(l.value.host="Field is required",i=!1),e.databaseConfig.port||(l.value.port="Field is required",i=!1),(r=e.databaseConfig.username)!=null&&r.trim()||(l.value.username="Field is required",i=!1),i}}),(i,t)=>(c(),h("div",Je,[m(V,{modelValue:n(e).databaseConfig.dbname,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).databaseConfig.dbname=a),label:"Database name",variant:"outlined",density:"comfortable","error-messages":l.value.dbname,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).databaseConfig.host,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).databaseConfig.host=a),label:"Database host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).databaseConfig.port,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).databaseConfig.port=a),label:"Database port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).databaseConfig.username,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).databaseConfig.username=a),label:"Username",variant:"outlined",density:"comfortable","error-messages":l.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).databaseConfig.password,"onUpdate:modelValue":t[4]||(t[4]=a=>n(e).databaseConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":"auto"},null,8,["modelValue"]),m(we,{modelValue:n(e).databaseConfig.collation,"onUpdate:modelValue":t[5]||(t[5]=a=>n(e).databaseConfig.collation=a),items:n(T).db_collations,label:"Database collation",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","items"])]))}});const We=S(Ke,[["__scopeId","data-v-38e4ac00"]]),Xe={class:"install-view-elastic-config"},Ye=k({__name:"InstallViewElasticConfig",setup(d,{expose:s}){const e=U(),l=g({host:"",port:""});return s({nextBtn:{action:async()=>{await e.validateElastic()&&e.nextStep()}},validate:()=>{var t;l.value={host:"",port:""};let i=!0;return(t=e.elasticConfig.host)!=null&&t.trim()||(l.value.host="Field is required",i=!1),e.elasticConfig.port||(l.value.port="Field is required",i=!1),i}}),(i,t)=>(c(),h("div",Xe,[m(V,{modelValue:n(e).elasticConfig.host,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).elasticConfig.host=a),label:"Elastic host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).elasticConfig.port,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).elasticConfig.port=a),label:"Elastic port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).elasticConfig.username,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).elasticConfig.username=a),label:"Username (optional)",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"]),m(V,{modelValue:n(e).elasticConfig.password,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).elasticConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":""},null,8,["modelValue"])]))}});const Qe=S(Ye,[["__scopeId","data-v-166cc1bb"]]),Ze={class:"install-view-site-config"},et={class:"install-view-dummy-data"},tt={class:"install-view-dummy-data-help"},at=k({__name:"InstallViewSiteConfig",setup(d,{expose:s}){const e=U(),l=g(!1),i=g({url:"",username:"",password:""});return s({validate:()=>{var a,r,o;i.value={url:"",username:"",password:""};let t=!0;return(a=e.siteConfig.url)!=null&&a.trim()||(i.value.url="Field is required",t=!1),(r=e.siteConfig.username)!=null&&r.trim()||(i.value.username="Field is required",t=!1),(o=e.siteConfig.password)!=null&&o.trim()||(i.value.password="Field is required",t=!1),t}}),(t,a)=>(c(),h("div",Ze,[m(V,{modelValue:n(e).siteConfig.url,"onUpdate:modelValue":a[0]||(a[0]=r=>n(e).siteConfig.url=r),label:"Site URL",variant:"outlined",density:"comfortable","error-messages":i.value.url,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).siteConfig.username,"onUpdate:modelValue":a[1]||(a[1]=r=>n(e).siteConfig.username=r),label:"Admin username",variant:"outlined",density:"comfortable","error-messages":i.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),m(V,{modelValue:n(e).siteConfig.password,"onUpdate:modelValue":a[2]||(a[2]=r=>n(e).siteConfig.password=r),type:l.value?"text":"password",label:"Admin password",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","append-inner-icon":l.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[3]||(a[3]=r=>l.value=!l.value),"error-messages":i.value.password,"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","error-messages"]),y("div",et,[m(Ne,{modelValue:n(e).siteConfig.demodata,"onUpdate:modelValue":a[4]||(a[4]=r=>n(e).siteConfig.demodata=r),color:"secondary",label:"Import dummy data","hide-details":""},null,8,["modelValue"]),m(Ve,{location:"top start",text:"A set of dummy records will be installed on your system for demonstration purposes."},{activator:N(({props:r})=>[y("div",tt,[m(M,G(r,{icon:"mdi-help",size:"14",color:"white"}),null,16)])]),_:1})])]))}});const st=S(at,[["__scopeId","data-v-e0e38c7c"]]),nt={class:"install-view-installation"},lt={class:"installation-step-label"},ot=k({__name:"InstallViewInstallation",setup(d,{expose:s}){const e=U(),l=g({}),i=g(null),t=g(null);s({prevBtn:!1,nextBtn:!1}),ae(async()=>{e.install(),await a(),t.value=setInterval(async()=>{await a()},1e3)}),Ce(()=>{t.value&&clearInterval(t.value)});async function a(){var o;try{const u=await I.get("api/install/status");Object.keys(u.data||{}).length!==Object.keys(l.value).length&&(l.value=u.data||{})}catch(u){u instanceof Ae&&((o=u.response)==null?void 0:o.status)===404&&(e.isInstallationCompleted=!0)}}const r=E(()=>{var o;return Object.keys((o=l.value)!=null?o:{}).length?Object.keys(l.value).map(u=>parseInt(u)).sort((u,v)=>u<v?1:u>v?-1:0)[0]:0});return se(()=>l.value,async()=>{var o;await Ie(),(o=i.value)==null||o.scrollTo({behavior:"smooth",left:0,top:i.value.scrollHeight})}),(o,u)=>(c(),h("div",nt,[m(xe,{color:"primary",stream:"","rounded-bar":"",rounded:"",height:"6",style:{"min-height":"6px"},"model-value":r.value,max:21},null,8,["model-value"]),y("div",{class:"install-view-installation-steps",ref_key:"stepsContainer",ref:i},[(c(!0),h(P,null,K(l.value,(v,f)=>(c(),h("div",{key:f,class:"install-view-installation-step"},[parseInt(f)===r.value?(c(),C(ne,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",style:{overflow:"hidden"}})):(c(),C(M,{key:1,icon:"mdi-check-circle",color:"#097c31",size:"20"})),y("span",lt,$(v.replaceAll("_"," ")),1)]))),128))],512)]))}});const it=S(ot,[["__scopeId","data-v-b87e48e3"]]),T={steps:[{title:"License",component:qe},{title:"System Environment Check",component:Ge},{title:"Database configuration",component:We},{title:"ElasticSearch configuration",component:Qe},{title:"Site configuration",component:st},{title:"Installation",component:it}],db_collations:["utf8mb4_general_ci","utf8mb4_bin","utf8mb4_unicode_ci","utf8mb4_icelandic_ci","utf8mb4_latvian_ci","utf8mb4_romanian_ci","utf8mb4_slovenian_ci","utf8mb4_polish_ci","utf8mb4_estonian_ci","utf8mb4_spanish_ci","utf8mb4_swedish_ci","utf8mb4_turkish_ci","utf8mb4_czech_ci","utf8mb4_danish_ci","utf8mb4_lithuanian_ci","utf8mb4_slovak_ci","utf8mb4_spanish2_ci","utf8mb4_roman_ci","utf8mb4_persian_ci","utf8mb4_esperanto_ci","utf8mb4_hungarian_ci","utf8mb4_sinhala_ci","utf8mb4_german2_ci","utf8mb4_croatian_ci","utf8mb4_unicode_520_ci","utf8mb4_vietnamese_ci"]},U=ke("install-view",()=>{const d=Se(),s=g(!1),e=g(!1),l=g(!1),i=g(""),t=g(null),a=g(null),r=g(!1),o=g({dbname:"minthcm",host:"localhost",port:3306,username:"root",password:"",collation:"utf8mb4_general_ci"}),u=g({host:"localhost",port:9200,username:"",password:""}),v=g({url:window.location.href.split("#")[0],username:"admin",password:"",demodata:!1}),f=g(""),_=g(0),x=E(()=>T.steps[_.value]);async function L(){var b,w,p,F,A,W,X,Y,Q,Z;e.value=!0;try{const B=await I.get("api/install/init");i.value=(w=(b=B.data)==null?void 0:b.version)!=null?w:"",t.value=(F=(p=B.data)==null?void 0:p.license)!=null?F:"",a.value=(W=(A=B.data)==null?void 0:A.environment)!=null?W:"",r.value=(Y=(X=B.data)==null?void 0:X.isInstalling)!=null?Y:!1,e.value=!1,(Q=B.data)!=null&&Q.isInstalling&&(_.value=T.steps.length-1)}catch(B){((Z=B.response)==null?void 0:Z.status)===404&&d.push({name:"dashboard"})}}async function q(){var w,p;const b=await I.get("api/install/license");t.value=(p=(w=b.data)==null?void 0:w.license)!=null?p:""}async function z(){s.value=!0;const b=await I.get("api/install/init");b.data.environment&&(a.value=b.data.environment),s.value=!1}async function O(){var b,w;s.value=!0;try{const p=await I.post("api/install/validate_db",o.value);return s.value=!1,((b=p.data)==null?void 0:b.status)===0?(f.value=p.data.message,console.error((w=p.data.error)!=null?w:p.data.message),!1):!0}catch(p){return console.error(p),f.value="Server error",s.value=!1,!1}}async function j(){var b,w;s.value=!0;try{const p=await I.post("api/install/validate_elastic",u.value);return s.value=!1,((b=p.data)==null?void 0:b.status)===0?(f.value=p.data.message,console.error((w=p.data.error)!=null?w:p.data.message),!1):!0}catch(p){return console.error(p),f.value="Server error",s.value=!1,!1}}async function R(){var w,p,F;if(r.value==!0)return!0;r.value=!0;const b=await I.post("api/install/submit",{db:o.value,elastic:u.value,site:v.value});if(typeof b.data=="string"||typeof b.data=="object"&&((w=b.data)==null?void 0:w.status)===0){const A=(F=(p=b.data.error)!=null?p:b.data.message)!=null?F:b.data;return f.value=A,console.error(A),!1}return l.value=!0,!0}function H(){_.value--}function de(){_.value++}return se(()=>_.value,()=>f.value=""),{currentStepNumber:_,currentStep:x,isInitialLoading:e,isLoading:s,isInstallationCompleted:l,version:i,license:t,environment:a,databaseConfig:o,elasticConfig:u,siteConfig:v,errorMsg:f,prevStep:H,nextStep:de,fetchLicense:q,recheckEnvironment:z,fetchInitialData:L,validateDb:O,validateElastic:j,install:R,isInstalling:r}}),rt=d=>(ie("data-v-a7508c66"),d=d(),re(),d),ut={class:"install-view-completed"},dt=rt(()=>y("h1",null,"Finished",-1)),ct=k({__name:"InstallViewCompleted",setup(d){function s(){location.reload()}return(e,l)=>(c(),h("div",ut,[dt,m(oe,{type:"success"},{default:N(()=>[le(" Your MintHCM installation is ready. Go ahead and log-in as an administrator. ")]),_:1}),m(J,{variant:"primary",text:"Go to login",style:{width:"100%"},onClick:s})]))}});const mt=S(ct,[["__scopeId","data-v-a7508c66"]]),ue=d=>(ie("data-v-6f321b40"),d=d(),re(),d),pt={key:1,class:"install-view"},vt={class:"install-view-title"},ft=ue(()=>y("h1",null,"MintHCM Setup Wizard",-1)),_t={class:"install-view-container"},bt={key:0,class:"install-view-loader"},gt={class:"install-view-container-title"},yt={class:"install-view-buttons"},ht={class:"install-view-footer"},wt=ue(()=>y("div",{class:"install-view-footer"},[y("a",{href:"https://minthcm.org",target:"_blank"}," www.minthcm.org ")],-1)),Vt=k({__name:"InstallView",setup(d){const s=U(),e=g(null),l=E(()=>{var o,u,v,f,_,x;return typeof((u=(o=e.value)==null?void 0:o.prevBtn)==null?void 0:u.label)=="string"?e.value.prevBtn.label:((f=(v=e.value)==null?void 0:v.prevBtn)==null?void 0:f.label)&&typeof((x=(_=e.value)==null?void 0:_.prevBtn)==null?void 0:x.label)=="object"?e.value.prevBtn.label.value:"Back"}),i=E(()=>{var o,u,v,f,_,x;return typeof((u=(o=e.value)==null?void 0:o.nextBtn)==null?void 0:u.label)=="string"?e.value.nextBtn.label:((f=(v=e.value)==null?void 0:v.nextBtn)==null?void 0:f.label)&&typeof((x=(_=e.value)==null?void 0:_.nextBtn)==null?void 0:x.label)=="object"?e.value.nextBtn.label.value:"Next"});ae(()=>{s.fetchInitialData(),window.addEventListener("keydown",t)}),Be(()=>{window.removeEventListener("keydown",t)});function t(o){if(!(s.isInstalling||document.querySelectorAll(".v-menu .v-list").length>0)){if(o.key==="Enter"){if(s.isInstallationCompleted){location.reload();return}r()}(o.key==="Escape"||o.key==="Esc")&&s.currentStepNumber!==0&&!s.isInstallationCompleted&&a()}}function a(){var o,u;((o=e.value)==null?void 0:o.prevBtn)&&typeof e.value.prevBtn.action=="function"?(u=e.value)==null||u.prevBtn.action():s.prevStep()}function r(){var o,u,v;typeof((o=e.value)==null?void 0:o.validate)=="function"&&!e.value.validate()||(((u=e.value)==null?void 0:u.nextBtn)&&typeof e.value.nextBtn.action=="function"?(v=e.value)==null||v.nextBtn.action():s.nextStep())}return(o,u)=>{var v,f;return n(s).isInitialLoading?(c(),C(Ue,{key:0})):(c(),h("div",pt,[y("div",vt,[ft,y("span",null,"Version "+$(n(s).version),1)]),y("div",_t,[n(s).isInstallationCompleted?(c(),C(mt,{key:0})):(c(),h(P,{key:1},[m($e,null,{default:N(()=>[n(s).isLoading?(c(),h("div",bt,[m(ne,{indeterminate:"",color:"primary",size:"64"})])):D("",!0)]),_:1}),y("div",gt,$(n(s).currentStep.title),1),n(s).errorMsg?(c(),C(oe,{key:0,type:"error"},{default:N(()=>[le($(n(s).errorMsg),1)]),_:1})):D("",!0),m(Ee,{"hide-on-leave":""},{default:N(()=>{var _;return[(c(),C(Le((_=n(s).currentStep)==null?void 0:_.component),{ref_key:"stepComponent",ref:e},null,512))]}),_:1}),y("div",yt,[((v=e.value)==null?void 0:v.prevBtn)!==!1&&n(s).currentStepNumber!==0?(c(),C(J,{key:0,variant:"text",text:l.value,onClick:a},null,8,["text"])):D("",!0),((f=e.value)==null?void 0:f.nextBtn)!==!1?(c(),C(J,{key:1,variant:"primary",text:i.value,onClick:r},null,8,["text"])):D("",!0)]),y("div",ht,[(c(!0),h(P,null,K(n(T).steps.length,_=>(c(),h("div",{key:_,class:Fe({"install-view-footer-dot":!0,"install-view-footer-dot-active":n(s).currentStepNumber===_-1})},null,2))),128))])],64))]),wt]))}}});const Tt=S(Vt,[["__scopeId","data-v-6f321b40"]]);export{Tt as default};
